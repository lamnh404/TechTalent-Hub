<% 
    var suggestions = (typeof suggestions !== 'undefined' && suggestions) ? suggestions : [];
%>

<%- include('../partials/header', { title: 'Gợi ý việc làm' }) %>

<body class="dashboard-page">
    <div class="dashboard-wrapper">
        
        <%- include('../partials/dashboard-sidebar', { activePage: 'suggestions' }) %>
        <%- include('../partials/navbar', { activePage: 'suggestions' }) %>

        <main class="main-content">
            
            <header class="dashboard-header">
                <h5 class="mb-0 font-weight-bold text-dark">Job Suggestions</h5>
            </header>

            <div class="p-4">
                <div class="mb-4">
                    <div class="alert alert-info border-0 shadow-sm rounded-lg">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-magic text-primary mr-3" style="font-size: 1.5rem;"></i>
                            <div>
                                <h6 class="font-weight-bold mb-0 text-primary">Smart Matching</h6>
                                <small>These jobs are selected based on your <strong>Skill Profile</strong>. Update your skills to get better recommendations.</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <% if (suggestions && suggestions.length > 0) { %>
                        <% suggestions.forEach(job => { %>
                            <div class="col-md-6 col-xl-4 mb-4">
                                <div class="card border-0 shadow-sm h-100 hover-scale job-card p-3" style="border-radius: 16px;">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <img src="<%= job.LogoURL || '/images/default-company.png' %>" width="50" height="50" class="rounded border p-1 object-fit-contain bg-white">
                                        
                                        <div class="text-center">
                                            <div class="position-relative d-inline-flex align-items-center justify-content-center">
                                                <svg viewBox="0 0 36 36" class="circular-chart orange" width="45" height="45">
                                                    <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                                    <path class="circle" stroke-dasharray="<%= job.MatchScore %>, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                                </svg>
                                                <span class="position-absolute small font-weight-bold text-dark" style="font-size: 0.7rem;"><%= Math.round(job.MatchScore) %>%</span>
                                            </div>
                                            <small class="d-block text-muted" style="font-size: 0.65rem;">Match</small>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-3">
                                        <h6 class="font-weight-bold text-dark mb-1 text-truncate">
                                            <a href="/jobs/<%= job.JobID %>" class="text-dark text-decoration-none stretched-link"><%= job.JobTitle %></a>
                                        </h6>
                                        <p class="small text-muted mb-2"><%= job.CompanyName %> • <%= job.Location %></p>
                                        <div class="d-flex align-items-center">
                                            <span class="badge badge-soft-primary mr-2"><%= job.EmploymentType %></span>
                                            <span class="text-success font-weight-bold small">$<%= job.SalaryMin ? job.SalaryMin.toLocaleString() : 'N/A' %></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <div class="col-12 text-center py-5">
                            <img src="/images/empty-state.svg" width="150" class="mb-3 opacity-50">
                            <h4>No matches found yet</h4>
                            <p class="text-muted">Try adding more skills to your profile to get suggestions.</p>
                            <a href="/seeker/profile" class="btn btn-primary px-4 rounded-pill">Update Profile</a>
                        </div>
                    <% } %>
                </div>
            </div>
        </main>
    </div>
    <%- include('../partials/footer') %>

    <style>
        .circular-chart { display: block; margin: 0 auto; max-width: 80%; max-height: 250px; }
        .circle-bg { fill: none; stroke: #eee; stroke-width: 3.8; }
        .circle { fill: none; stroke-width: 2.8; stroke-linecap: round; animation: progress 1s ease-out forwards; }
        .circular-chart.orange .circle { stroke: #ff9f00; }
        @keyframes progress { 0% { stroke-dasharray: 0 100; } }
    </style>
</body>