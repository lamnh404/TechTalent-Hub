<%- include('../partials/header', { title: 'Company Profile Setup' }) %>

    <body class="auth-layout-page">
        <section class="auth-hero">

            <a href="/" class="brand-logo">
                <img src="/images/logo.svg" alt="Logo" class="brand-logo-icon">
                <div class="brand-name-container">
                    <span class="brand-name-main">TechTalent</span><span class="brand-name-accent">Hub</span>
                </div>
            </a>

            <div class="sky-arcs"></div>

            <div class="auth-content-wrapper">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-lg-8 col-md-10">
                            <div class="card auth-card animate__animated animate__fadeInUp">
                                <div class="card-body p-4 p-md-5">

                                    <div class="text-center mb-4">
                                        <span
                                            class="badge badge-pill badge-light text-success mb-2 shadow-sm px-3 py-1">Step
                                            2 of 2</span>
                                        <h3 class="mb-1 font-weight-bold text-dark">Company Profile</h3>
                                        <p class="text-muted small">Provide details about your organization.</p>
                                    </div>

                                    <form action="/auth/register/complete" method="POST" id="companyForm" novalidate>

                                        <div class="form-group mb-3">
                                            <label class="font-weight-bold small text-dark">Company Name <span
                                                    class="text-danger">*</span></label>
                                            <div class="input-wrapper">
                                                <i class="far fa-building input-icon"></i>
                                                <input type="text" class="form-control-modern" name="CompanyName"
                                                    placeholder="TechTalent Inc." required>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="font-weight-bold small text-dark">Industry</label>
                                                <div class="input-wrapper">
                                                    <i class="fas fa-globe input-icon"></i>
                                                    <select class="form-control-modern" name="Industry">
                                                        <option value="Software">IT / Software</option>
                                                        <option value="Fintech">Fintech</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="font-weight-bold small text-dark">Size</label>
                                                <div class="input-wrapper">
                                                    <i class="fas fa-users input-icon"></i>
                                                    <select class="form-control-modern" name="CompanySize">
                                                        <option value="Small">Startup (1-10)</option>
                                                        <option value="Medium">Growing (11-50)</option>
                                                        <option value="Large">Established (51-200)</option>
                                                        <option value="Enterprise">Enterprise (200+)</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="font-weight-bold small text-dark">Website</label>
                                                <div class="input-wrapper">
                                                    <i class="fas fa-link input-icon"></i>
                                                    <input type="url" class="form-control-modern https-input"
                                                        name="CompanyWebsite" placeholder="https://company.com"
                                                        required>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="font-weight-bold small text-dark">Founded Year</label>
                                                <div class="input-wrapper">
                                                    <i class="far fa-calendar-alt input-icon"></i>
                                                    <input type="number" class="form-control-modern" name="FounderYear"
                                                        placeholder="2015">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group mb-3">
                                            <label class="font-weight-bold small text-dark">Headquarters
                                                Location</label>
                                            <div class="input-wrapper">
                                                <i class="fas fa-map-marked-alt input-icon"></i>
                                                <input type="text" class="form-control-modern" name="CompanyAddress"
                                                    placeholder="District 1, Ho Chi Minh City" required>
                                            </div>
                                        </div>

                                        <div class="form-group mb-3">
                                            <label class="font-weight-bold small text-dark">Description</label>
                                            <textarea class="form-control-modern pt-3 h-auto" name="CompanyDescription"
                                                rows="3" placeholder="Briefly describe your company..."></textarea>
                                        </div>

                                        <div class="form-group mb-4">
                                            <label class="font-weight-bold small text-dark">Company Logo URL <span
                                                    class="text-danger">*</span></label>
                                            <div class="input-wrapper">
                                                <i class="far fa-image input-icon"></i>
                                                <input type="url" class="form-control-modern https-input" name="LogoURL"
                                                    placeholder="https://example.com/logo.png" required>
                                            </div>
                                        </div>

                                        <button type="submit"
                                            class="btn btn-success btn-block shadow-lg py-3 font-weight-bold">
                                            Finish Registration <i class="fas fa-check ml-2"></i>
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <%- include('../partials/footer') %>
        </section>

        <script>
            const form = document.getElementById('companyForm');
            const submitBtn = form.querySelector('button[type="submit"]');
            const httpsInputs = document.querySelectorAll('.https-input');
            const requiredInputs = form.querySelectorAll('[required]');

            // 1. Hàm kiểm tra toàn bộ form
            function checkFormValidity() {
                let isValid = true;

                // Check HTTPS inputs
                httpsInputs.forEach(input => {
                    // Nếu có nhập thì phải bắt đầu bằng https://
                    if (input.value && !input.value.startsWith('https://')) isValid = false;
                });

                // Check các trường required khác (không được rỗng)
                requiredInputs.forEach(input => {
                    if (!input.value.trim()) isValid = false;
                });

                // Toggle nút Submit
                if (isValid) {
                    submitBtn.removeAttribute('disabled');
                    submitBtn.style.opacity = '1';
                    submitBtn.style.cursor = 'pointer';
                } else {
                    submitBtn.setAttribute('disabled', 'true');
                    submitBtn.style.opacity = '0.6';
                    submitBtn.style.cursor = 'not-allowed';
                }
            }

            // 2. Validate HTTPS (Real-time UI Feedback)
            httpsInputs.forEach(input => {
                input.addEventListener('input', function () {
                    const value = this.value.trim();
                    // Logic tìm thẻ lỗi: Bỏ qua thẻ text-muted nếu có
                    let errorDisplay = this.parentElement.nextElementSibling;
                    if (errorDisplay && !errorDisplay.classList.contains('error-msg')) {
                        errorDisplay = errorDisplay.nextElementSibling;
                    }

                    if (value && !value.startsWith('https://')) {
                        if (errorDisplay) errorDisplay.classList.remove('d-none');
                        this.classList.add('is-invalid');
                    } else {
                        if (errorDisplay) errorDisplay.classList.add('d-none');
                        this.classList.remove('is-invalid');
                    }

                    checkFormValidity();
                });
            });

            // 3. Lắng nghe sự kiện cho các trường còn lại
            requiredInputs.forEach(input => {
                input.addEventListener('input', checkFormValidity);
                input.addEventListener('change', checkFormValidity);
            });

            // Chạy lần đầu để khóa nút
            checkFormValidity();
        </script>
    </body>