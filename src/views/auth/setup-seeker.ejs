<%- include('../partials/header', { title: 'Hoàn tất hồ sơ' }) %>

<body class="auth-layout-page">
    <section class="auth-hero">
        
        <a href="/" class="brand-logo">
            <img src="/images/favicon-t.svg" alt="Logo" class="brand-logo-icon">
            <div class="brand-name-container">
                <span class="brand-name-main">TechTalent</span><span class="brand-name-accent">Hub</span>
            </div>
        </a>

        <div class="sky-arcs"></div>

        <div class="auth-content-wrapper">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8 col-md-10">
                        <div class="card auth-card animate__animated animate__fadeInUp">
                            <div class="card-body p-4 p-md-5">
                                
                                <div class="text-center mb-4">
                                    <span class="badge badge-pill badge-light text-primary mb-2 shadow-sm px-3 py-1">Step 2 of 2</span>
                                    <h3 class="mb-1 font-weight-bold text-dark">Candidate Profile</h3>
                                    <p class="text-muted small">Tell us about your professional background.</p>
                                </div>

                                <form action="/auth/register/complete" method="POST" id="seekerForm" novalidate>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="font-weight-bold small text-dark">First Name <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control-modern" name="FirstName" placeholder="John" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="font-weight-bold small text-dark">Last Name <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control-modern" name="LastName" placeholder="Doe" required>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="font-weight-bold small text-dark">Phone Number <span class="text-danger">*</span></label>
                                            <div class="input-wrapper">
                                                <i class="fas fa-phone input-icon"></i>
                                                <input type="tel" class="form-control-modern" id="phoneNumber" name="PhoneNumber" placeholder="0901234567" required>
                                            </div>
                                            <small class="text-danger error-msg d-none mt-1">Invalid phone number (10-11 digits)</small>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="font-weight-bold small text-dark">Gender</label>
                                            <div class="input-wrapper">
                                                <i class="fas fa-venus-mars input-icon"></i>
                                                <select class="form-control-modern" name="Gender">
                                                    <option value="MALE">Male</option>
                                                    <option value="FEMALE">Female</option>
                                                    <option value="OTHER">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group mb-3">
                                        <label class="font-weight-bold small text-dark">Date of Birth <span class="text-danger">*</span></label>
                                        <div class="input-wrapper">
                                            <i class="far fa-calendar-alt input-icon"></i>
                                            <input type="date" class="form-control-modern" id="dob" name="DateOfBirth" required>
                                        </div>
                                        <small class="text-danger error-msg d-none mt-1">Must be at least 15 years old</small>
                                    </div>

                                    <div class="form-group mb-3">
                                        <label class="font-weight-bold small text-dark">Professional Title</label>
                                        <div class="input-wrapper">
                                            <i class="fas fa-id-card input-icon"></i>
                                            <input type="text" class="form-control-modern" name="title" placeholder="e.g. Senior Frontend Developer">
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="font-weight-bold small text-dark">Experience Level</label>
                                            <div class="input-wrapper">
                                                <i class="fas fa-layer-group input-icon"></i>
                                                <select class="form-control-modern" name="ExperienceLevel">
                                                    <option value="Intern">Intern / Fresher</option>
                                                    <option value="Junior">Junior (1-2 years)</option>
                                                    <option value="Mid">Mid-level (3-5 years)</option>
                                                    <option value="Senior">Senior (5+ years)</option>
                                                    <option value="Lead">Manager / Lead</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="font-weight-bold small text-dark">Current Location</label>
                                            <div class="input-wrapper">
                                                <i class="fas fa-map-marker-alt input-icon"></i>
                                                <input type="text" class="form-control-modern" name="CurrentLocation" placeholder="e.g. Ho Chi Minh City">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group mb-3">
                                        <label class="font-weight-bold small text-dark">Top Skills (Comma separated)</label>
                                        <div class="input-wrapper">
                                            <i class="fas fa-code input-icon"></i>
                                            <input type="text" class="form-control-modern" name="skills" placeholder="ReactJS, Node.js, MySQL...">
                                        </div>
                                    </div>

                                    <div class="form-group mb-4">
                                        <label class="font-weight-bold small text-dark">CV / Portfolio Link <span class="text-danger">*</span></label>
                                        <div class="input-wrapper">
                                            <i class="fas fa-link input-icon"></i>
                                            <input 
                                                type="url" 
                                                class="form-control-modern https-input" 
                                                name="CVFileURL" 
                                                placeholder="https://drive.google.com/..." 
                                                required
                                            >
                                        </div>
                                        <small class="text-muted">Link to your CV PDF or Portfolio (Must start with https://)</small>
                                        <small class="text-danger error-msg d-none d-block mt-1">
                                            <i class="fas fa-exclamation-triangle"></i> Link must start with https://
                                        </small>
                                    </div>

                                    <button type="submit" class="btn btn-cta-dark btn-block shadow-lg py-3">
                                        Complete Profile <i class="fas fa-check-circle ml-2"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <%- include('../partials/footer') %>
    </section>

    <script>
        const form = document.getElementById('seekerForm');
        const submitBtn = form.querySelector('button[type="submit"]');
        
        // Inputs needed for validation
        const phoneInput = document.querySelector('input[name="PhoneNumber"]');
        const dobInput = document.querySelector('input[name="DateOfBirth"]');
        const httpsInputs = document.querySelectorAll('.https-input');
        
        // Required inputs
        const requiredInputs = form.querySelectorAll('[required]');

        // Regex for phone number validation
        const phoneRegex = /^(0|\+84)\d{9,10}$/; 

        // 1. Function to check overall form validity
        function checkFormValidity() {
            let isValid = true;

            // Check Phone
            if (!phoneRegex.test(phoneInput.value.trim())) isValid = false;

            // Check DOB
            if (!isDobValid()) isValid = false;

            // Check HTTPS fields
            httpsInputs.forEach(input => {
                if (!input.value.startsWith('https://')) isValid = false;
            });

            // Check other required fields (not empty)
            requiredInputs.forEach(input => {
                if (!input.value.trim()) isValid = false;
            });

            // Toggle Submit button
            if (isValid) {
                submitBtn.removeAttribute('disabled');
                submitBtn.style.opacity = '1';
                submitBtn.style.cursor = 'pointer';
            } else {
                submitBtn.setAttribute('disabled', 'true');
                submitBtn.style.opacity = '0.6';
                submitBtn.style.cursor = 'not-allowed';
            }
        }

        // 2. Validate Phone (Real-time)
        phoneInput.addEventListener('input', function() {
            const errorDisplay = this.parentElement.nextElementSibling;
            const value = this.value.trim();
            
            if (value && !phoneRegex.test(value)) {
                errorDisplay.classList.remove('d-none');
                this.classList.add('is-invalid');
            } else {
                errorDisplay.classList.add('d-none');
                this.classList.remove('is-invalid');
            }
            checkFormValidity();
        });

        // 3. Validate DOB (Real-time)
        function isDobValid() {
            if (!dobInput.value) return false;
            const dob = new Date(dobInput.value);
            const today = new Date();
            let age = today.getFullYear() - dob.getFullYear();
            const m = today.getMonth() - dob.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) age--;
            return (dob <= today && age >= 15);
        }

        dobInput.addEventListener('change', function() {
            const errorDisplay = this.parentElement.nextElementSibling;
            
            if (!isDobValid()) {
                errorDisplay.classList.remove('d-none');
                this.classList.add('is-invalid');
            } else {
                errorDisplay.classList.add('d-none');
                this.classList.remove('is-invalid');
            }
            checkFormValidity();
        });

        // 4. Validate HTTPS (Real-time)
        httpsInputs.forEach(input => {
            input.addEventListener('input', function() {
                const errorDisplay = this.parentElement.nextElementSibling; // Thẻ small.text-muted
                const errorMsg = errorDisplay.nextElementSibling; // Thẻ small.text-danger
                
                const value = this.value.trim();
                
                if (value && !value.startsWith('https://')) {
                    if(errorMsg) errorMsg.classList.remove('d-none');
                    this.classList.add('is-invalid');
                } else {
                    if(errorMsg) errorMsg.classList.add('d-none');
                    this.classList.remove('is-invalid');
                }
                checkFormValidity();
            });
        });

        // 5. Listen for input events on all other fields to enable the button
        requiredInputs.forEach(input => {
            input.addEventListener('input', checkFormValidity);
            input.addEventListener('change', checkFormValidity);
        });

        // Run initial check (to disable the button initially)
        checkFormValidity();

    </script>
</body>