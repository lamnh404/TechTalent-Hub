<%- include('../partials/header', { title: 'Dashboard' }) %>

<body class="dashboard-page">
    <div class="dashboard-wrapper">
        <%- include('../partials/navbar', { activePage: 'dashboard' }) %>

        <main class="main-content">
            <header class="dashboard-header">
                <h5 class="mb-0 font-weight-bold text-dark">Overview</h5>
            </header>

            <div class="p-4">
                <div class="mb-4">
                    <h4 class="font-weight-bold text-dark">Welcome back, <%= (typeof user !== 'undefined' && user.email) ? user.email.split('@')[0] : 'Recruiter' %>! ðŸ‘‹</h4>
                    <p class="text-muted">Here is what's happening with your job postings today.</p>
                </div>

                <div class="mb-4">
                    <form action="/company/dashboard/stats" method="POST" class="form-inline">
                        <div class="form-group mr-2">
                            <label class="small text-muted mr-2">Start</label>
                            <input type="date" name="startDate" class="form-control form-control-sm" value="<%= typeof startDate !== 'undefined' ? startDate : '' %>">
                        </div>
                        <div class="form-group mr-2">
                            <label class="small text-muted mr-2">End</label>
                            <input type="date" name="endDate" class="form-control form-control-sm" value="<%= typeof endDate !== 'undefined' ? endDate : '' %>">
                        </div>
                        <button type="submit" class="btn btn-primary btn-sm">Find Statistics</button>
                    </form>
                </div>

                <% if (typeof noApplicationsInRange !== 'undefined' && noApplicationsInRange) { %>
                    <div class="alert alert-info">No applications in this time range.</div>
                <% } else if (typeof appStats !== 'undefined' && appStats) { %>
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="card border-0 shadow-sm rounded-lg p-3">
                                <h6 class="font-weight-bold mb-3">Application Statistics</h6>
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="small text-muted">Jobs Posted</div>
                                        <div class="font-weight-bold"><%= appStats.TotalJobPosted %></div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="small text-muted">Total Applications</div>
                                        <div class="font-weight-bold"><%= appStats.TotalApplications %></div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="small text-muted">Submitted</div>
                                        <div class="font-weight-bold"><%= appStats.SubmittedCount %></div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="small text-muted">Under Review</div>
                                        <div class="font-weight-bold"><%= appStats.UnderReviewCount %></div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="small text-muted">Interview</div>
                                        <div class="font-weight-bold"><%= appStats.InterviewCount %></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                <% } %>

                <div class="row mb-4">
                    <div class="col-md-3 mb-3 mb-md-0">
                        <div class="stat-card h-100 hover-scale">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <p class="text-muted small font-weight-bold text-uppercase mb-1">Active Jobs</p>
                                    <h3 class="font-weight-bold text-dark mb-0"><%= stats.activeJobs %></h3>
                                </div>
                                <div class="stat-icon blue shadow-sm"><i class="fas fa-briefcase"></i></div>
                            </div>
                            <span class="text-muted small"><%= typeof stats.newJobsThisMonth !== 'undefined' ? stats.newJobsThisMonth + ' new this month' : '' %></span>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3 mb-md-0">
                        <div class="stat-card h-100 hover-scale">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <p class="text-muted small font-weight-bold text-uppercase mb-1">Applications</p>
                                    <h3 class="font-weight-bold text-dark mb-0"><%= stats.totalApplications %></h3>
                                </div>
                                <div class="stat-icon purple shadow-sm"><i class="fas fa-file-alt"></i></div>
                            </div>
                            
                        </div>
                    </div>
                    <div class="col-md-3 mb-3 mb-md-0">
                        <div class="stat-card h-100 hover-scale">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <p class="text-muted small font-weight-bold text-uppercase mb-1">Total Views</p>
                                    <h3 class="font-weight-bold text-dark mb-0"><%= stats.totalViews %></h3>
                                </div>
                                <div class="stat-icon green shadow-sm"><i class="fas fa-eye"></i></div>
                            </div>
                            <p class="text-muted small mb-0">Across all jobs</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card h-100 hover-scale">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <p class="text-muted small font-weight-bold text-uppercase mb-1">New Candidates</p>
                                    <h3 class="font-weight-bold text-dark mb-0"><%= stats.newCandidates %></h3>
                                </div>
                                <div class="stat-icon bg-warning text-white shadow-sm"><i class="fas fa-user-clock"></i></div>
                            </div>
                            <p class="text-muted small mb-0">Waiting for review</p>
                        </div>
                    </div>
                </div>

                <div class="card border-0 shadow-sm rounded-lg overflow-hidden">
                    <div class="card-header bg-white border-0 pt-4 px-4 pb-0 d-flex justify-content-between align-items-center">
                        <h5 class="font-weight-bold text-dark mb-0">Recent Job Posts</h5>
                        <a href="/company/jobs" class="btn btn-sm btn-light text-primary font-weight-bold rounded-pill px-3">View All</a>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table custom-table table-hover mb-0">
                                <thead class="bg-light">
                                    <tr>
                                        <th class="pl-4 border-top-0">Job Title</th>
                                        <th class="border-top-0">Posted Date</th>
                                        <th class="text-center border-top-0">Applicants</th>
                                        <th class="border-top-0">Status</th>
                                        <th class="text-right pr-4 border-top-0">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% if (recentJobs && recentJobs.length > 0) { %>
                                        <% recentJobs.forEach(job => { %>
                                            <tr>
                                                <td class="pl-4 align-middle font-weight-bold text-dark"><%= job.JobTitle %></td>
                                                <% const _pd = job.PostedDate ? new Date(job.PostedDate) : null; %>
                                                <td class="align-middle text-muted"><%= _pd ? _pd.toLocaleDateString('vi-VN') : '' %></td>
                                                <td class="align-middle text-center">
                                                    <div class="avatar-group justify-content-center">
                                                        <span class="badge badge-pill badge-light border px-3"><%= job.Applicants %></span>
                                                    </div>
                                                </td>
                                                <td class="align-middle">
                                                    <% if (job.Status === 'Open') { %>
                                                        <span class="badge badge-soft-success px-3 py-2">Active</span>
                                                    <% } else { %>
                                                        <span class="badge badge-soft-secondary px-3 py-2">Closed</span>
                                                    <% } %>
                                                </td>
                                                <td class="align-middle text-right pr-4">
                                                    <a href="/company/jobs/<%= job.JobID %>/edit" class="btn btn-sm btn-icon btn-light text-primary"><i class="fas fa-edit"></i></a>
                                                </td>
                                            </tr>
                                        <% }) %>
                                    <% } else { %>
                                        <tr><td colspan="5" class="text-center py-4 text-muted">No jobs posted yet.</td></tr>
                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <%- include('../partials/footer') %>